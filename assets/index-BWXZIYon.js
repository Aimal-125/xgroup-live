import{aA as v,A as S,aB as M,k as D,t as V,aC as A,aD as H,a as $,j as e,d as B,r as u,c as Y,aE as Z,aF as W,aG as _,H as G}from"./index-DXC4WxTY.js";import{u as K}from"./useQuery-dmNfqFuk.js";import{b as Q,E as J,F as O,a as X}from"./formik.esm-Nvf0k5vm.js";import{h as y}from"./moment-C5S46NFB.js";import{T as ee,a as te,b as C,c as j,d as se,e as f}from"./Tr-BAmmJf8y.js";import{M as F}from"./react-tooltip.min-DX0qBXNw.js";import{P as ae}from"./index-CvxaO4ZM.js";import{I as R}from"./img1-Dr1yV29J.js";import{E as re}from"./ExpandableText-BhLKt3lh.js";import{L as oe}from"./useWindowSize-CJaWzJUi.js";import{H as ne}from"./Heading-BW07qGLk.js";import{B as le}from"./BackBtn-CAoFsR9d.js";import{F as I}from"./FormControl-Vzz3kAOj.js";import{L as ce}from"./LoadingBtn-BPpN-Rmz.js";import{T as ie}from"./Input-C-gD7-3x.js";import{c as de,a as L}from"./index.esm-BrFfqCuP.js";import{D as me}from"./DisplayError-BPL7rDiG.js";import{I as xe}from"./ItemNotFound-PPiIMDK4.js";import"./index-LvzHWtTh.js";import"./index-Chjiymov.js";import"./ClipLoader-BeN6fJ0f.js";const T=d=>async(l,s)=>{var m,o;try{l(v(!0));const{token:a}=s().auth.user,{data:{data:{doc:i,message:c}}}=await S.post("/notification",d,{headers:{Authorization:`Bearer ${a}`}});l(M(i)),l(v(!1)),D.success(c)}catch(a){l(v(!1)),V(a||((o=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Something went wrong.")}},pe=d=>async(l,s)=>{var m,o,a,i;try{l(A(!0));const c=(o=(m=s().auth)==null?void 0:m.user)==null?void 0:o.token;if(!c)throw new Error("User authentication token is missing.");const{data:{data:{message:x}}}=await S.delete(`/notification/${d}`,{headers:{Authorization:`Bearer ${c}`}});console.log("his is the delete msg",x),l(H(d)),D.success(x)}catch(c){console.error("Delete Notification error:",c),D.error(((i=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:i.message)||(c==null?void 0:c.message)||"Something went wrong.")}finally{l(A(!1))}},he=({docs:d,currentPage:l,setCurrentPage:s,pages:m,startIndex:o})=>{const a=$(),i=t=>new Promise((n,g)=>{const p=new FileReader;p.readAsDataURL(t),p.onload=()=>n(p.result),p.onerror=h=>g(h)}),c=async t=>{if(console.log("notification:",t.title,t.body,t.attachment),t.attachment&&t.attachment!=="")try{const n=await fetch(`${B}/${t.attachment}`).then(h=>h.blob()),g=await i(n),p={title:t.title,body:t.body,attachmentDataURI:g};console.log("updatedNotification",p),a(T(p))}catch(n){console.error("Error converting attachment to Base64:",n)}else{const n={title:t.title,body:t.body};console.log("updatedNotification (no attachment)",n),a(T(n))}},x=t=>{console.log("see this id ",t),a(pe(t))};return e.jsx("div",{className:"bg-secondary rounded-lg p-2",children:e.jsxs("div",{className:"bg-dark  p-2 rounded-lg overflow-container  custom-scrollbar",children:[e.jsxs(ee,{className:"sm:text-base text-sm",children:[e.jsx(te,{className:"bg-secondary text-left rounded-lg",children:e.jsxs(C,{children:[e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Sr"}),e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Title"}),e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Description"}),e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Attachment"}),e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Date"}),e.jsx(j,{className:"font-medium px-6 py-4 text-center",children:"Actions"})]})}),e.jsx(se,{children:d.map((t,n)=>e.jsxs(C,{className:"text-grayText sm:hover:bg-stroke hover:text-pure border-b border-b-gray-700",children:[e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center text-right",children:t!=null&&t.longAutoIncrementId?t==null?void 0:t.longAutoIncrementId:o+n+1?o+n+1:"N/A"}),e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center text-right",children:t.title}),e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center",children:e.jsx(re,{text:t.body,startLength:12})}),e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center",children:t.attachment===null?e.jsx(e.Fragment,{}):e.jsx("div",{className:"flex w-full whitespace-nowrap justify-start sm:justify-center",children:e.jsx("img",{src:t.attachment?`${B}/${t.attachment}`:R,alt:"img",className:"w-[100px] h-[100px] object-cover",onError:g=>{g.target.src=R}})})}),e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center",children:y(t.createdAt).format("DD MMM YYYY")}),e.jsx(f,{className:"px-6 py-4 whitespace-nowrap sm:text-center ",children:e.jsxs("div",{className:"flex justify-start sm:justify-center items-center gap-4 text-xl",children:[e.jsxs("button",{className:"text-green-500","data-tooltip-id":"resend-notification","data-tooltip-content":"Resend",onClick:()=>c(t),children:[e.jsx("i",{className:"uil uil-repeat"}),e.jsx(F,{id:"resend-notification",style:{fontSize:15}})]}),e.jsxs("button",{className:"text-red-500","data-tooltip-id":"delete-notification","data-tooltip-content":"Delete",onClick:()=>x(t._id),children:[e.jsx("i",{className:"uil uil-trash"}),e.jsx(F,{id:"delete-notification",style:{fontSize:15}})]})]})})]},t._id))})]}),e.jsx(ae,{totalPages:m,currentPage:l,setCurrentPage:s})]})})},ue=({label:d,hint:l,field:s,form:m,height:o="200px",formik:a})=>{const i=u.useRef(null),c=x=>{const t=x.target.files[0],n=new FileReader;n.readAsDataURL(t),n.onloadend=()=>{m.setFieldValue(s.name,n.result)}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"w-full flex-1 flex flex-col gap-2",children:[d?e.jsxs("label",{className:"flex items-center gap-2 label",children:[d,l&&e.jsxs("span",{"data-tooltip-id":s.name,"data-tooltip-content":l,className:"text-grayText",children:[e.jsx("i",{className:"uil uil-info-circle"}),e.jsx(F,{id:s.name,style:{fontSize:15,background:"var(--primary)",width:220}})]})]}):"",e.jsx("input",{ref:i,type:"file",onChange:c,hidden:!0}),e.jsxs("div",{className:`
                    flex items-center justify-between border px-3 rounded-md cursor-pointer
                    ${a.touched[s.name]&&a.errors[s.name]?"border-red":null}
                    `,onClick:()=>{var x;return(x=i==null?void 0:i.current)==null?void 0:x.click()},children:[e.jsx("div",{children:"Choose File"}),e.jsx("div",{className:"py-3 px-6 border-l",children:"Browse"})]})]}),(s==null?void 0:s.value)&&e.jsx("div",{className:"mt-4 border-2 border-dashed w-fit",children:e.jsx("img",{src:s.value,alt:"",className:"min-w-[250px] w-full object-cover",style:{height:o}})})]})},ge=({label:d,name:l,height:s,formik:m,...o})=>e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(Q,{name:l,children:({field:a,form:i})=>e.jsx(ue,{label:d,field:a,form:i,height:s||"200px",formik:m,...o})}),e.jsx(J,{component:ie,name:l})]}),je=de().shape({title:L().required("Title is required."),body:L().required("Body is required.")}),fe={title:"",body:"",attachmentDataURI:""},qe=()=>{const[d,l]=u.useState(1),[s,m]=u.useState(""),[o,a]=u.useState(""),[i,c]=u.useState(""),[x,t]=u.useState(""),n=10,g=(d-1)*n;u.useEffect(()=>{if(s&&o){if(y(o).isSame(s)||y(o).isBefore(s))return t("2025-01-11T23:59:59.999Z");if(y(s).isAfter(o))return m("2025-01-11T23:59:59.999Z");c(s),t(o)}},[s,o]);const p=$(),{docs:h,pages:P,createnotificationsloading:E}=Y(r=>r.notification),{isLoading:U,data:b,isError:z,error:k}=K({queryKey:["fetch-all-notifications",i,x,d,n],queryFn:()=>{const r=new URLSearchParams;return r.append("page",d),r.append("pageSize",n),i&&r.append("from",i),x&&r.append("to",x),S.get(`/notification?${r.toString()}`)}});console.log("error",k),u.useEffect(()=>{if(b){const{data:{data:{docs:r,docsCount:N,pages:w}}}=b;p(Z(r)),p(W(N)),p(_(w))}},[b,p]);const q=async(r,{resetForm:N})=>{console.log("notification data",r);try{p(T(r)),N()}catch(w){console.error("Error creating notification:",w)}};return e.jsxs("div",{className:"flex flex-col space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{title:"Send Notification"}),e.jsx(le,{})]}),e.jsxs("div",{className:"flex justify-between max-[400px]:flex-col gap-5 mt-6 ",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{htmlFor:"fromDate",children:"From Date"}),e.jsx("input",{type:"date",id:"fromDate",name:"from",value:s,onChange:r=>{m(r.target.value)}})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{htmlFor:"toDate",children:"To Date"}),e.jsx("input",{type:"date",id:"toDate",name:"to",value:o,onChange:r=>{a(r.target.value)}})]})]}),e.jsx(O,{initialValues:fe,validationSchema:je,onSubmit:q,enableReinitialize:!0,children:r=>e.jsxs(X,{className:"bg-dark rounded-lg p-4 flex flex-col gap-3 mt-6 pb-6",children:[e.jsx(I,{control:"input",label:"Title",placeholder:"Enter notification title",name:"title",formik:r}),e.jsx(I,{control:"textarea",label:"Body",placeholder:"Write about notification",name:"body",formik:r}),e.jsx("div",{children:e.jsx(ge,{label:"Attach File",name:"attachmentDataURI",height:"200px",formik:r})}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:"btn-primary py-2 px-12",disabled:E||!r.isValid||r.isSubmitting,children:E?e.jsx(ce,{}):"Send"})})]})}),e.jsx("div",{className:"mt-6",children:U?e.jsx(oe,{}):z?e.jsx(me,{message:G(k)}):(h==null?void 0:h.length)>0?e.jsx(he,{docs:h,currentPage:d,setCurrentPage:l,pages:P,startIndex:g}):e.jsx(xe,{message:"No notifications available."})})]})};export{qe as default};
