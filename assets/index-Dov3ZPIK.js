import{b as E,r as u,a as P,T as C,j as a,d as D,L as F,$ as A,A as B,a0 as q,c as z,k as H,a1 as I}from"./index-B7EDHShO.js";import{u as K}from"./useQuery-BH2ipur7.js";import{B as R}from"./BackBtn-CSTzC4ci.js";import{D as T}from"./DisplayError-DJ1Lcd3h.js";import{H as Q}from"./Heading-DW26iUKW.js";import{L as V}from"./useWindowSize-DFtMrG7S.js";import{I as G}from"./ItemNotFound-DyPlXfej.js";import{I as J}from"./img1-CxsS-zk5.js";import{P as O}from"./index-CqrQsClu.js";import{S as W}from"./Search-oN7CJQ-M.js";import"./LoadingBtn-DmYHjot9.js";import"./ClipLoader-DJNL0iZY.js";const X=({chats:o,currentPage:x,setCurrentPage:S,pages:t})=>{const h=E();u.useState([]);const j=P(),k=C(),{_id:i}=k,N=async(e,c,n)=>{if(c&&j(A(c)),n)try{const{data:r}=await B.patch(`/message/${n}`,{isSeen:"yes"});r!=null&&r.success&&j(q(!0))}catch(r){console.log(r)}finally{h(`/app/support/${e}`)}else h(`/app/support/${e}`)};return a.jsx("div",{className:"flex flex-col space-y-4 w-full mt-6",children:a.jsxs("div",{className:"flex flex-col w-full bg-dark rounded-lg p-4",children:[o==null?void 0:o.map(e=>{var c,n,r,d,w,s,y,l,p,f,g,b,v,$,_,L;return a.jsx("div",{className:`${((c=e==null?void 0:e.users[0])==null?void 0:c.status)==="deleted"?"hidden":""} flex overflow-auto flex-col max-[600px]:flex-col gap-2 justify-between items-center text-grayText-pure border-b border-b-gray-700 py-4 px-3 `,children:a.jsx("div",{className:"flex flex-col w-full",children:a.jsxs("div",{className:"flex items-center justify-between max-[600px]:w-full max-[600px]:flex-col max-[600px]:items-start gap-3",children:[a.jsxs("div",{className:"flex w-full items-center gap-3",children:[a.jsx("div",{className:"w-[50px]",children:a.jsx("img",{src:(n=e==null?void 0:e.users[0])!=null&&n.image?D+"/"+((r=e==null?void 0:e.users[0])==null?void 0:r.image):J,className:"w-[50px] h-[50px] rounded-full object-cover",alt:(d=e==null?void 0:e.users[0])!=null&&d.fullName?(w=e==null?void 0:e.users[0])==null?void 0:w.fullName:(s=e==null?void 0:e.users[0])==null?void 0:s.username})}),a.jsxs("div",{className:"flex flex-col space-y-1 text-md",children:[a.jsx("div",{className:"underline",children:a.jsx(F,{to:`/app/users/details/${(y=e==null?void 0:e.users[0])==null?void 0:y._id}`,children:a.jsx("p",{children:(l=e==null?void 0:e.users[0])!=null&&l.fullName?(p=e==null?void 0:e.users[0])==null?void 0:p.fullName:(f=e==null?void 0:e.users[0])==null?void 0:f.username})})}),a.jsx("div",{className:"w-full",children:a.jsx("p",{children:(g=e==null?void 0:e.latestMessage)!=null&&g.text?a.jsx("span",{className:"",children:a.jsx("span",{style:{wordBreak:"break-all"},className:`${((v=(b=e==null?void 0:e.latestMessage)==null?void 0:b.sender)==null?void 0:v._id)!==i&&(($=e==null?void 0:e.latestMessage)==null?void 0:$.isSeen)===!1?"text-primary":""} text-[14px] inline-block`,children:(_=e==null?void 0:e.latestMessage)!=null&&_.text?((L=e==null?void 0:e.latestMessage)==null?void 0:L.text.substring(0,20))+"...":""})}):""})})]})]}),a.jsx("div",{className:" max-[600px]:w-full max-[600px]:px-0 ",children:a.jsxs("button",{onClick:()=>{var U,M;return N(e==null?void 0:e._id,(U=e==null?void 0:e.users[0])==null?void 0:U._id,(M=e==null?void 0:e.latestMessage)==null?void 0:M._id)},className:"w-[160px] max-[600px]:w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-700 text-white rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400",children:[a.jsx("i",{className:"uil uil-comments text-white",style:{fontSize:"20px"}})," ","Start Chat"]})})]})})},e==null?void 0:e._id)}),a.jsx(O,{totalPages:t,currentPage:x,setCurrentPage:S})]})})},de=()=>{const{userKeyword:o}=z(l=>l==null?void 0:l.support),[x,S]=u.useState([]),[t,h]=u.useState(1),[j,k]=u.useState(1),i=10,[N,e]=u.useState("latest_message_descending"),c=["fetch-usersList",{currentPage:t,limit:i,userKeyword:o,sort:N}],n=P(),{isLoading:r,data:d,isError:w,error:s}=K({queryKey:c,queryFn:()=>B.get(`/chat/?page=${t}&pageSize=${i}&keyword=${o}&sortBy=${N}`)});u.useEffect(()=>{var l,p,f,g;if(d){const{data:{data:{docs:b,pages:v}}}=d;S(b),k(v)}s&&H.error((p=(l=s==null?void 0:s.response)==null?void 0:l.data)!=null&&p.message?(g=(f=s==null?void 0:s.response)==null?void 0:f.data)==null?void 0:g.message:s==null?void 0:s.message)},[d,s]);const y=l=>{n(I(l))};return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsx(Q,{title:"Support"}),a.jsx(R,{})]}),a.jsx("div",{className:"bg-dark p-4 rounded-lg pb-6 mt-6",children:a.jsx("div",{className:"flex items-center justify-between gap-4 sm:flex-row flex-col",children:a.jsx("div",{className:"w-full max-[650px]:w-full",children:a.jsx(W,{label:"Search User",placeholder:"Username",fetcher:y})})})}),a.jsx("div",{className:"mt-6",children:r?a.jsx(V,{}):w?a.jsx(T,{message:"An error occurred while fetching users."}):(x==null?void 0:x.length)===0?a.jsx(G,{message:"No data found."}):a.jsx(X,{chats:x,currentPage:t,setCurrentPage:h,pages:j})})]})};export{de as default};
