import{ac as f,A as N,ad as y,t as F,ae as h,af as B,k as $,j as e,r as j,a as k,b as q,d as m,u as P,c as S}from"./index-CR2PTnGP.js";import{b as L,E as C,F as E,a as K}from"./formik.esm-DTrArBGY.js";import{c as R,f as u,a as I}from"./index.esm-DrRihLu7.js";import{F as b}from"./FormControl-BPiWpiF7.js";import{d as A}from"./deposits.constants-BksPp1tF.js";import{L as T}from"./LoadingBtn-BtdHQEGi.js";import{T as U}from"./Input-DgNLSsv0.js";import{B as V}from"./BackBtn-qMQnlAqP.js";import{H as z}from"./Heading-BGYpxq2W.js";import{I as O}from"./ItemNotFound-BOlywaMD.js";import{L as _}from"./useWindowSize-Do2-NPva.js";import"./react-tooltip.min-8-V3KYLF.js";import"./index-LvzHWtTh.js";import"./index-Chjiymov.js";import"./ClipLoader-BVQCHCPU.js";const H=(s,a)=>async(r,i)=>{var l,t;console.log("  this is   updatedData",a);try{r(h(!0));const{token:o}=i().auth.user,{data:{data:{doc:d,message:n}}}=await N.patch(`/know-your-customer/${s}`,a,{headers:{Authorization:`Bearer ${o}`}});r(B({id:s,updatedData:d})),r(h(!1)),$.success(n)}catch(o){r(h(!1)),F(o||((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Something went wrong.")}},M=s=>async a=>{a(f(!0));try{const{data:{data:{doc:r}}}=await N(`/know-your-customer/${s}`);a(y(r)),a(f(!1))}catch(r){a(f(!1)),F(r)}},W=({label:s,field:a,form:r,initialImage:i,showDelete:l=!0})=>{const[t,o]=j.useState(i||null),d=j.useRef(null),n=()=>{d.current.click()},c=w=>{const p=w.target.files[0];if(p){const g=new FileReader;g.onloadend=()=>{o(g.result),r.setFieldValue(a.name,p)},g.readAsDataURL(p)}},v=()=>{o(null),r.setFieldValue(a.name,null)};return e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"font-semibold pb-2",children:s}),e.jsx("div",{className:`w-full h-[300px] border border-[#374151] flex justify-center items-center cursor-pointer border-dashed relative rounded-md ${r.touched[a.name]&&r.errors[a.name]?"border-red-500":""}`,onClick:n,children:t?e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"absolute z-10 right-2 top-1 text-2xl text-red-500 cursor-pointer",onClick:v,children:e.jsx("i",{className:"uil uil-trash"})}),e.jsx("img",{src:t,alt:"Selected Preview",className:"w-fit h-full object-cover"})]}):e.jsx("i",{className:"uil uil-plus text-4xl"})}),e.jsx("input",{ref:d,type:"file",className:"hidden",accept:"image/*",onChange:c}),e.jsx(C,{component:U,name:a.name})]})},x=({label:s,name:a,initialImage:r,showDelete:i,...l})=>e.jsx("div",{className:"flex-1 flex flex-col gap-2",children:e.jsx(L,{name:a,children:({field:t,form:o,meta:d})=>e.jsx(W,{label:s,field:t,form:o,meta:d,initialImage:r,showDelete:i,...l})})}),Y=({docDetails:s,updateLoading:a})=>{const r=k(),i=q();console.log(" all docdetail",s);const l=R().shape({uploadIdFront:u().required("Front Id/Passport Image is required"),uploadIdBack:u().required("Back Id/Passport Image is required"),nomineeIdFront:u().required("Front Nominee Id/Passport Image is required"),nomineeIdBack:u().required("Back Nominee Id/Passport Image is required"),nft:u().required("Favorite Object/NFT Image is required"),status:I().required("Status is required"),description:I().required("Description is required")}),t={uploadIdFront:s!=null&&s.idFront?`${m}/${s.idFront}`:null,uploadIdBack:s!=null&&s.idBack?`${m}/${s.idBack}`:null,nomineeIdFront:s!=null&&s.nomineeIdFront?`${m}/${s.nomineeIdFront}`:null,nomineeIdBack:s!=null&&s.nomineeIdBack?`${m}/${s.nomineeIdBack}`:null,nft:s!=null&&s.nft?`${m}/${s.nft}`:null,status:"",description:""},o=n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),d=async n=>{console.log("  this is updated formData",n);try{if(!(s!=null&&s._id)){console.error("No document ID found");return}const c={status:o(n.status),description:n.description};await r(H(s._id,c)),i("/app/kyc")}catch(c){console.error("Error updating KYC:",c)}};return e.jsx("div",{className:"bg-stroke p-4 w-full rounded-lg",children:e.jsx(E,{initialValues:t,validationSchema:l,onSubmit:d,children:n=>e.jsxs(K,{className:"rounded-lg flex max-lg:flex-col gap-5 ",children:[e.jsxs("div",{className:"w-[60%] max-lg:w-full flex flex-col gap-5  ",style:{pointerEvents:"none"},children:[e.jsx("h1",{className:"text-xl font-bold",children:"ID/Passport"}),e.jsxs("div",{className:"bg-dark flex flex-col gap-4 p-4 rounded-lg",children:[e.jsx(x,{label:"Id/Passport Front",name:"uploadIdFront",initialImage:t.uploadIdFront,showDelete:!1}),e.jsx(x,{label:"Id/Passport Back",name:"uploadIdBack",initialImage:t.uploadIdBack,showDelete:!1})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Nominee ID/Passport"}),e.jsxs("div",{className:"bg-dark flex flex-col gap-4 p-4 rounded-lg",children:[e.jsx(x,{label:"Nominee Id/Passport Front",name:"nomineeIdFront",initialImage:t.nomineeIdFront,showDelete:!1}),e.jsx(x,{label:"Nominee Id/Passport Back",name:"nomineeIdBack",initialImage:t.nomineeIdBack,showDelete:!1})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Favorite Object/NFT"}),e.jsx("div",{className:"bg-dark flex flex-col gap-4 p-4 rounded-lg",children:e.jsx(x,{label:"Favorite Object/NFT",name:"nft",initialImage:t.nft,showDelete:!1})})]}),e.jsxs("div",{className:"w-[40%] max-lg:w-full flex flex-col gap-5",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Details"}),e.jsxs("div",{className:"bg-dark flex flex-col gap-4 p-4 rounded-lg",children:[e.jsx(b,{control:"select",label:"Status",name:"status",options:A,formik:n,touched:n.touched,errors:n.errors}),e.jsx(b,{control:"textarea",label:"Description",placeholder:"Write here...",name:"description",formik:n,maxLength:100,touched:n.touched,errors:n.errors}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{type:"submit",className:"btn-primary py-2 px-12",disabled:a||n.isSubmitting,children:a?e.jsx(T,{}):"Send"})})]})]})]})})})},de=()=>{const{id:s}=P(),a=k(),{docDetails:r,loading:i,updateLoading:l}=S(t=>t==null?void 0:t.kyc);return j.useEffect(()=>{a(M(s))},[a,s]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{title:"Kyc Details"}),e.jsx(V,{})]}),i?e.jsx(_,{}):r?e.jsx("div",{className:"flex lg:gap-6 gap-4 lg:flex-row flex-col mt-6",children:e.jsx("div",{className:"lg:flex-[1.0] bg-dark rounded-lg",children:e.jsx(Y,{docDetails:r,updateLoading:l})})}):e.jsx(O,{message:"Kyc not found."})]})};export{de as default};
