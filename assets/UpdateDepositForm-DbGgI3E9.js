import{j as e,L,u as q,r as N,c as Y,A as U,k as y}from"./index-DXC4WxTY.js";import{h as H}from"./moment-C5S46NFB.js";import{S as O}from"./Status-DBi7uq6n.js";import{f as A}from"./formatAmount-CWLewUcu.js";import{P as F}from"./plus-icon-CADXI1Pn.js";import{c as V,a as $,e as z}from"./index.esm-BrFfqCuP.js";import{F as K}from"./FormControl-Vzz3kAOj.js";import{d as B}from"./deposits.constants-BksPp1tF.js";import{F as W,a as G,b as J}from"./formik.esm-Nvf0k5vm.js";import{C as Q}from"./ClipLoader-BeN6fJ0f.js";const i=({label:r,value:o,to:l})=>e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-b-gray-700 p-4",children:[e.jsx("h6",{children:r}),l?e.jsx(L,{to:l,className:"text-grayText underline",children:o}):e.jsx("div",{className:"text-grayText",children:o})]}),X=({label:r,icon:o,value:l,currencyCode:d})=>e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-b-gray-700 p-4",children:[e.jsx("h6",{children:r}),e.jsxs("p",{className:"text-grayText flex items-center gap-2 ",children:[e.jsxs("span",{children:["1 ",d==="PKR"?"PKR":"USD"," ="]}),e.jsx("img",{src:o,alt:"plus icon"}),e.jsx("span",{children:l})]})]}),Z=({label:r,icon:o,value:l})=>e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-b-gray-700 p-4",children:[e.jsx("h6",{children:r}),e.jsxs("p",{className:"text-grayText flex items-center gap-2 ",children:[e.jsx("img",{src:o,alt:"plus icon"}),e.jsx("span",{children:l})]})]}),oe=({doc:r})=>{const{user:{username:o,fullName:l,email:d,phone:x},orderId:{orderID:p,amountPKR:h,amountUSD:j,currencyCode:b,coinPKRExchangeRate:m,coinUSDExchangeRate:c,paymentMethod:g},orderId:{depositorAccountInfo:s,verificationMethod:v},coins:f,createdAt:a,status:n}=r;return e.jsxs("div",{children:[e.jsx(i,{label:"Full Name",value:l||"N/A"}),e.jsx(i,{label:"Username",value:o,to:"/app/users/details/2344"}),e.jsx(i,{label:"Email",value:d}),e.jsx(i,{label:"Phone",value:x}),e.jsx(i,{label:"Order Id",value:p||"N/A"}),e.jsx(i,{label:"Deposit Amount",value:b==="USD"?e.jsxs("span",{children:[A(j*.01)," USD"]}):e.jsxs("span",{children:[A(h*.01)," PKR"]})}),e.jsx(X,{label:"Exchange Rate",icon:F,value:m?(1/(m.toFixed(2)*.01)).toFixed(2):c?(1/c.toFixed(2)).toFixed(2):"N/A",currencyCode:b}),e.jsx(Z,{label:"Coins Received",icon:F,value:f?f.toFixed(2):"N/A"}),e.jsx(i,{label:"Verification Method",value:v||"N/A"}),e.jsx(i,{label:"Financial Institution",value:s!=null&&s.financialInstitutionTitle?s==null?void 0:s.financialInstitutionTitle:"N/A"}),e.jsx(i,{label:"Deposited By",value:g||(s==null?void 0:s.paymentMethod)}),e.jsx(i,{label:"Account Holder",value:s!=null&&s.accountHolderTitle?s==null?void 0:s.accountHolderTitle:"N/A"}),e.jsx(i,{label:"Account No",value:s!=null&&s.accountNumber?s==null?void 0:s.accountNumber:"N/A"}),e.jsx(i,{label:"Date",value:H(a).format("DD MMM YYYY hh:mm A")}),e.jsx(i,{label:"Current Status",value:e.jsx(O,{status:n})})]})},_=V().shape({status:$().oneOf(["Pending","Approved","Declined"],"Invalid status").required("Status is required."),amount:z().typeError("Must be a number").required("Required").positive("Must be positive"),description:$()}),ce=({currencyCode:r,coins:o,amountReceived:l})=>{const{id:d}=q(),[x,p]=N.useState(l*100||""),[h,j]=N.useState(o),[b,m]=N.useState(!1),{docDetails:c,updateLoading:g}=Y(a=>a.deposit),s={status:c==null?void 0:c.status,amount:l,description:(c==null?void 0:c.description)||""},v=async(a,{setSubmitting:n})=>{var S,R,C,D,P,w,E,M,T;let u;u={...a,amount:x};try{n(!0);const{data:t}=await U.patch(`/deposit/${d}`,u);t!=null&&t.success&&y.success((S=t==null?void 0:t.data)==null?void 0:S.message)}catch(t){y.error((D=(C=(R=t==null?void 0:t.response)==null?void 0:R.data)==null?void 0:C.data)!=null&&D.message?(E=(w=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:w.data)==null?void 0:E.message:(T=(M=t==null?void 0:t.response)==null?void 0:M.data)==null?void 0:T.message)}finally{n(!1)}},f=a=>{a.target.value||j(""),setTimeout(()=>{p(parseFloat(a.target.value).toFixed(2)*100)},1e3)};return N.useEffect(()=>{x&&(async()=>{try{m(!0);const{data:n}=await U.post("/deposit/calculate-coins",{depositObjectId:d,amount:x,currencyCode:r});if(n!=null&&n.success){const{data:{coins:u}}=n;j(parseFloat(u).toFixed(2))}}catch(n){if(n.response){const{response:{data:{message:u}}}=n;y.error(u)}}finally{m(!1)}})()},[x,r,d]),e.jsx("div",{children:e.jsx(W,{initialValues:s,validationSchema:_,onSubmit:v,enableReinitialize:!0,children:a=>e.jsxs(G,{autoComplete:"off",className:"flex flex-col gap-4",children:[e.jsx(K,{control:"select",label:"Status",name:"status",options:B,formik:a}),e.jsxs("div",{className:"flex flex-col gap-[5px]",children:[e.jsxs("label",{className:"flex items-center gap-2 font-bold",htmlFor:"amount",children:[e.jsx("span",{children:"Amount Received"}),e.jsxs("span",{children:["(",r,")"]})]}),e.jsx(J,{className:`${a.errors.amount&&a.touched.amount?"border-red-500 focus:border-red-500":""} bg-inherit py-[13px] px-[18px] rounded-lg outline-none focus:border-2 focus:border-blue-500 border border-gray-700 transition`,name:"amount",id:"amount",onChange:n=>{a.handleChange(n),f(n)}}),h?e.jsxs("p",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-yellow-500",children:"Coins Received:"}),e.jsx("span",{children:e.jsx("img",{src:F,alt:"coins received icon",width:"16px",height:"16px"})}),b?e.jsx("span",{className:"loader"}):e.jsx("span",{children:h})]}):"",a.errors.amount&&a.touched.amount?e.jsx("div",{className:"text-red-500 text-sm",children:a.errors.amount}):null]}),e.jsx(K,{control:"textarea",label:"Description",placeholder:"Write here...",name:"description",formik:a,maxLength:50}),e.jsx("div",{className:"mt-6 flex items-end justify-end",children:e.jsx("button",{type:"submit",className:"btn-primary py-2 px-12",disabled:a.isSubmitting,children:g?e.jsx(Q,{size:20,color:"white"}):"Save"})})]})})})};export{oe as D,ce as U};
